<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<head>
	<title>Hazelware</title>
	<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
	<LINK REL="SHORTCUT ICON" HREF="logo.ico">
</head>



<body vlink='#3173EB' link='#3173EB' leftmargin=0 topmargin=0 marginwidth=0 marginheight=0>

<meta name="ICBM" content="45.30027, -122.9719" />
<meta name="keywords" content="Palm PalmOS WinCE PocketPC PDA Development Wireless" />
<meta name="description" content="Postings from a wireless PDA developer." />
<link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml" />
<style type="text/css">
<!--
A		{text-decoration:none}
a		{text-decoration:none}
A:hover 	{ color: #000000;  }
a:hover 	{ color: #000000;  }
-->
</style>


<table border=0 valign=top width=780>
	<TR>
		<TD width=100 valign=top>
		</TD>

		<!-- Title graphic -->
		<TD width=620 valign=top>
			<center><IMG SRC="/images/title.jpg" border=0 width=319 height=69></center>
			<br>&nbsp &nbsp &nbsp 


				<b><small>Logged in as <I><A HREF='/login.html'>Guest</A></I> &nbsp Fri, Mar. 26th, 4:19 AM.  &nbsp &nbsp &nbsp </small></b>
	
		</TD>
		<TD>
		</TD>
	</TR>
	<TR>

		<!-- Spacer for left border -->
		<TD>
		<!-- MyMap -->
		<a href="http://www.maploco.com/view.php?id=2376202"><img border=0 width=150 height=75 src="http://www.maploco.com/vmap/2376202.png" alt="Visitor Map"></a>
		</TD>

		<!-- Image map for browsing -->
		<TD width=620 valign=top>
			<TABLE width="100%" align=center valign=top>
				<TR>
					<TD width="100%">
						<MAP NAME="linkmap">
							<AREA SHAPE="RECT" COORDS= "10,27,90,52"  HREF="/">
							<AREA SHAPE="RECT" COORDS="100,27,207,52" HREF="/programs/">
							<AREA SHAPE="RECT" COORDS="220,27,328,52" HREF="/tutorials/">
							<AREA SHAPE="RECT" COORDS="338,27,428,52" HREF="/friends/">
							<AREA SHAPE="RECT" COORDS="442,27,509,52" HREF="/links/">
							<AREA SHAPE="RECT" COORDS="517,27,608,52" HREF="mailto:bosshogg@luggle.com">
						</MAP>
						<IMG src="/images/header.jpg" width=619 height=79 USEMAP="#linkmap" border=0>
					</TD>
				</TR>
			</TABLE>

		</TD>

		<TD>
		</TD>

		<TD>
		</TD>	
	</TR>
	
	<TR>
		<TD align=right valign=top>

		<TABLE border=0 cellspacing=0 cellpadding=0 width=150 align=center valign=top bordercolor='#000000'>
<TR><TD>
<TABLE border=1 cellspacing=0 cellpadding=5 width=100% align=center valign=top bordercolor='#000000'><TR><TD bgcolor='#B5D0FF'><B>Recent Entries:</B></TD></TR>
<TR><TD bgcolor='#ffffff' height=100%>
<small>
<TABLE valign=top align=left>
<TR><TD valign=top>
<IMG SRC='/images/smallbullet.gif' width=7 height=13></TD><TD>
<a href='/archive-127.html'><small>My Dev Setup Lately</small></a></TD></TR>
<TR><TD valign=top>
<IMG SRC='/images/smallbullet.gif' width=7 height=13></TD><TD>
<a href='/archive-126.html'><small>Three Ways To Randomize on the iPhone</small></a></TD></TR>
<TR><TD valign=top>
<IMG SRC='/images/smallbullet.gif' width=7 height=13></TD><TD>
<a href='/archive-125.html'><small>How to Remove .svn Directories On a Mac</small></a></TD></TR>
<TR><TD valign=top>
<IMG SRC='/images/smallbullet.gif' width=7 height=13></TD><TD>
<a href='/archive-124.html'><small>How To Detect The iPhone Simulator</small></a></TD></TR>
<TR><TD valign=top>
<IMG SRC='/images/smallbullet.gif' width=7 height=13></TD><TD>
<a href='/archive-123.html'><small>iPhoneMom Likes Doodle Games!</small></a></TD></TR>
<TR><TD valign=top>
<IMG SRC='/images/smallbullet.gif' width=7 height=13></TD><TD>
<a href='/archive-122.html'><small>Updates To the Doodle Games Line</small></a></TD></TR>
<TR><TD valign=top>
<IMG SRC='/images/smallbullet.gif' width=7 height=13></TD><TD>
<a href='/archive-120.html'><small>Three Jacks Now Tweets</small></a></TD></TR>
<TR><TD valign=top>
<IMG SRC='/images/smallbullet.gif' width=7 height=13></TD><TD>
<a href='/archive-119.html'><small>Second iPhone App Submitted For Approval!</small></a></TD></TR>
<TR><TD valign=top>
<IMG SRC='/images/smallbullet.gif' width=7 height=13></TD><TD>
<a href='/archive-118.html'><small>Pinch Media Analytics for iPhone</small></a></TD></TR>
<TR><TD valign=top>
<IMG SRC='/images/smallbullet.gif' width=7 height=13></TD><TD>
<a href='/archive-117.html'><small>New iPhone Game Coming Soon!</small></a></TD></TR>
</TABLE>
</TD></TR>
<TR><TD align=center valign=center>
<A HREF='/rss.xml'><IMG SRC='/images/rss.gif' border=0 width=60 height=14></A>
</TD></TR>
</TABLE>
</TD></TR>
<TR><TD><SMALL><SMALL><BR></SMALL></SMALL></TD></TR><TR><TD><TABLE border=1 cellspacing=0 cellpadding=5 width=100% align=center valign=top bordercolor='#000000'><TR><TD bgcolor='#B5D0FF'><B>Archive:</B></TD></TR><TR><TD bgcolor='#ffffff'><A HREF='/archive-2010.1.html'>January - 2010</A><br><A HREF='/archive-2009.11.html'>November - 2009</A><br><A HREF='/archive-2009.10.html'>October - 2009</A><br><A HREF='/archive-2009.9.html'>September - 2009</A><br><A HREF='/archive-2009.8.html'>August - 2009</A><br><A HREF='/archive-2009.7.html'>July - 2009</A><br><A HREF='/archive-2009.6.html'>June - 2009</A><br><A HREF='/archive-2009.4.html'>April - 2009</A><br><A HREF='/archive-2009.3.html'>March - 2009</A><br><A HREF='/archive-2009.1.html'>January - 2009</A><br><A HREF='/archive-2008.5.html'>May - 2008</A><br><A HREF='/archive-2008.4.html'>April - 2008</A><br><A HREF='/archive-2008.3.html'>March - 2008</A><br><A HREF='/archive-2007.10.html'>October - 2007</A><br><A HREF='/archive-2007.8.html'>August - 2007</A><br><A HREF='/archive-2007.7.html'>July - 2007</A><br><A HREF='/archive-2007.6.html'>June - 2007</A><br><A HREF='/archive-2007.5.html'>May - 2007</A><br><A HREF='/archive-2007.4.html'>April - 2007</A><br><A HREF='/archive-2006.12.html'>December - 2006</A><br><A HREF='/archive-2006.11.html'>November - 2006</A><br><A HREF='/archive-2006.9.html'>September - 2006</A><br><A HREF='/archive-2006.8.html'>August - 2006</A><br><A HREF='/archive-2006.7.html'>July - 2006</A><br><A HREF='/archive-2006.3.html'>March - 2006</A><br><A HREF='/archive-2006.2.html'>February - 2006</A><br><A HREF='/archive-2006.1.html'>January - 2006</A><br><A HREF='/archive-2005.12.html'>December - 2005</A><br><A HREF='/archive-2005.11.html'>November - 2005</A><br><A HREF='/archive-2005.10.html'>October - 2005</A><br><A HREF='/archive-2005.9.html'>September - 2005</A><br><A HREF='/archive-2005.8.html'>August - 2005</A><br><A HREF='/archive-2005.7.html'>July - 2005</A><br><A HREF='/archive-2005.6.html'>June - 2005</A><br><A HREF='/archive-2005.5.html'>May - 2005</A><br><A HREF='/archive-2005.4.html'>April - 2005</A><br><A HREF='/archive-2005.2.html'>February - 2005</A><br><A HREF='/archive-2005.1.html'>January - 2005</A><br><A HREF='/archive-2004.12.html'>December - 2004</A><br><A HREF='/archive-2004.11.html'>November - 2004</A><br><A HREF='/archive-2004.10.html'>October - 2004</A><br><A HREF='/archive-2004.9.html'>September - 2004</A><br><A HREF='/archive-2004.8.html'>August - 2004</A><br><A HREF='/archive-2004.7.html'>July - 2004</A><br><A HREF='/archive-2004.6.html'>June - 2004</A><br><A HREF='/archive-2004.5.html'>May - 2004</A><br><A HREF='/archive-2004.4.html'>April - 2004</A><br><A HREF='/archive-2004.3.html'>March - 2004</A><br></TD></TR></TABLE></small>
</TD></TR></TABLE>

		</TD>
		<TD width=620 valign=top>


<TABLE border=1 bordercolor='#000000' cellspacing=0 cellpadding=0><TR><TD>

<TABLE BGCOLOR='#B5D0FF' width=600 cellspacing=0 cellpadding=10 border=0>
<TR><TD height=50 align=center width=100%>
	<BIG><BIG><B>Translating Hardware Exceptions to C++ Exceptions</B></BIG></BIG>
</TD></TR>
</TABLE>
</TD></TR><TR><TD>
<TABLE BGCOLOR='#ffffff' cellspacing=0 width=600 cellpadding=10 align=center>

<TR><TD width=600>
No matter how careful of a programmer you are, there will always be times when a hardware
exception will occur in your code.  Perhaps it was a third party component that was the
culprit.  Perhaps, it was a fellow co-worker that broke something.  Or maybe it was
Microsoft itself not playing fair with its documentation and/or implementations.  
Whatever the case, it is often very useful to be able to capture a run-time exception
that was generated by the CPU.  Sure, you can use a catch(...) to be your fail-safe, but
wouldn't it be great to be able to convert that exception that was generated by the hardware 
into a C++ exception?  I created this class in order to do that very thing.  In fact,
this class was the basis for my super assert that I created, because I found that I could 
cause a hardware exception any time I wanted, and by using this C++ hardware exception container,
I could access each thread's stack frame at run-time.  This would eventually enable me to 
perform a stack trace inside of an assert, but I will explain that more in a different 
tutorial.
<BR>Anyway, I hope that this is useful to someone.  I spent a while digging around in the
mire that is Microsoft's documentation before I put this together.  Perhaps this will save
someone else time in the future.
<BR>Enjoy.
<BR><I>-BossHogg</I>
<BR>
<BR>
<PRE>
#ifndef HARDWARE_EXCEPTION
#define HARDWARE_EXCEPTION 1


enum HWExceptionType
{
	eIllegalMemoryAccess	= EXCEPTION_ACCESS_VIOLATION,
	eUnexpectedBreakpoint 	= EXCEPTION_BREAKPOINT,
	eDataTypeMisalignment 	= EXCEPTION_DATATYPE_MISALIGNMENT,
	eSingleStepInstruction 	= EXCEPTION_SINGLE_STEP,
	eArrayBoundsExceeded	= EXCEPTION_ARRAY_BOUNDS_EXCEEDED,
	eDenormalFloat 		= EXCEPTION_FLT_DENORMAL_OPERAND,
	eFloatDivideByZero 	= EXCEPTION_FLT_DIVIDE_BY_ZERO,
	eFloatInexactResult	= EXCEPTION_FLT_INEXACT_RESULT,
	eFloatInvalidOperation 	= EXCEPTION_FLT_INVALID_OPERATION,
	eFloatOverflow 		= EXCEPTION_FLT_OVERFLOW,
	eFloatStackCorrupted 	= EXCEPTION_FLT_STACK_CHECK,
	eFloatUnderflow 	= EXCEPTION_FLT_UNDERFLOW,
	eIntDivideByZero 	= EXCEPTION_INT_DIVIDE_BY_ZERO,
	eIntOverflow 		= EXCEPTION_INT_OVERFLOW,
	ePrivelegedInstruction 	= EXCEPTION_PRIV_INSTRUCTION,
	eUncontinuableException = EXCEPTION_NONCONTINUABLE_EXCEPTION
};


class HWException
{
     public:
          HWException(HWExceptionType aType,
                      EXCEPTION_POINTERS* pExp):
	       itsCategory(aType),
	       itsPointers(pExp),
	       itsLocation(pExp->ExceptionRecord->ExceptionAddress)
          {
	  }

	  HWExceptionType     GetCategory()  const {return itsCategory;}
	  DWORD		      GetLocation()  const {return itsLocation;}
	  EXCEPTION_POINTERS* GetSysPointer()const {return itsPointers;}

     protected:
          HWExceptionType	itsCategory;
	  DWORD			itsLocation;
	  EXCEPTION_POINTERS*	itsPointers;
};


static void HWTranslateException(unsigned int u, 
                                 EXCEPTION_POINTERS* pExp)
{
	throw HWException((HWExceptionType)u,pExp);
}

#endif



///////////////////////////////////////////////////////////////////////
Example usage:
///////////////////////////////////////////////////////////////////////

#include "windows.h"
#include "HWException.h"


int main()
{
	//Note, setting the exception translator must be done 
	//on a per thread basis.
	_set_se_translator(HWTranslateException);

	try {
		//This will cause an access violation
		char* ptr = NULL;
		*ptr = 5; 	
	}
	catch (HWException& e)
	{
		//We can now know both the type and the
		//memory location of the instruction that
		//caused the exception.  Cool!

		HWExceptionType exceptionType = e.GetCategory();
		DWORD address = e.GetLocation();
	}
	catch (...)
	{
		//If we got here, then it was some other kind
		//of C++ exception...
	}

	return 0;
}


</PRE>
</TD></TR></TABLE>
</TD></TR></TABLE>
		</TD>
	</TR>
</TABLE>
<BR>
<TABLE width=800>
	<TR>
		<TD width=120>
			&nbsp
		</TD>
		<TD>
			<MAP NAME="siteinfo">
				<AREA SHAPE="RECT" COORDS="525,6,545,23" HREF="http://www.redhat.com/">
				<AREA SHAPE="RECT" COORDS="546,6,575,23" HREF="http://www.apache.org/">
				<AREA SHAPE="RECT" COORDS="576,6,607,23" HREF="http://www.php.net/">
			</MAP>
			<IMG SRC="/images/footer.jpg" USEMAP="#siteinfo" border=0 width=619 height=26>
		</TD>
	</TR>
</TABLE>
</body>
</html>

